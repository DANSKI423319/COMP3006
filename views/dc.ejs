<!DOCTYPE html>
<html>

<head>
  <title>Computers-Dev</title>
  <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="custom-styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
</head>

<body style="margin: 20px">
  <h3>Desk Manager</h3>
  <h4 class="text-muted">Status Checker</h4>
  <br />

  <div class="row">
    <div id="padded-box" class="col-sm-3 border border-secondary rounded">
      <div id="formBox">
        <!-- Add Computer Form -->
        <div id="computer-form-box" class="border border-secondary rounded;">
          <h5>Add Computer</h5>
          <form method="post" action="/insert" class="insertForm">
            <div class="form-group">
              <label for="addName">Name</label>
              <input type="text" name="addName" id="inputName" class="form-control" maxlength="10"
                placeholder="Type here..." />
            </div>
            <div class="form-group">
              <label for="addStatus">Status</label>
              <select name="addStatus" class="form-control">
                <option>Working</option>
                <option>Not working</option>
                <option>Scheduled for maintenance</option>
                <option>N/A</option>
              </select>
            </div>
            <div class="form-group">
              <label for="addNotes">Notes</label>
              <input type="text" name="addNotes" id="inputNotes" class="form-control" placeholder="Type here..." />
            </div>
            <div class="form-group">
              <label for="addRoom">Room</label>
              <input type="number" name="addRoom" id="inputRoom" class="form-control" placeholder="Type here..." />
            </div>
            <input type="submit" id="btnComputerAdd" class="form-control btn btn-primary" value="Confirm" />
          </form>

          <br />

          <!-- Update room form -->
          <h5>Update Computer</h5>
          <form method="post" action="/update" class="updateForm">
            <div class="form-group">
              <label for="searchId">Computer ID</label>
              <input type="text" id="txtSearch" name="searchId" class="form-control" disabled />
            </div>
            <div class="form-group">
              <label for="searchName">Name</label>
              <input type="text" id="txtName1" name="searchName" class="form-control border border-danger"
                title="Do not edit this field" disabled />
              <input type="text" id="txtName2" name="updateName" class="form-control border border-success" disabled />
            </div>
            <div class="form-group">
              <label for="updateStatus">Status</label>
              <select id="txtStatus" name="updateStatus" class="form-control" disabled>
                <option>Working</option>
                <option>Not working</option>
                <option>Scheduled for maintenance</option>
                <option>N/A</option>
              </select>
            </div>
            <div class="form-group">
              <label for="updateNotes">Notes</label>
              <input type="text" id="txtNotes" name="updateNotes" class="form-control" disabled />
            </div>
            <div class="form-group">
              <label for="updateRoom">Room</label>
              <input type="number" id="txtRoom" name="updateRoom" class="form-control" disabled />
            </div>
            <input type="submit" id="btnUpdate" class="form-control btn btn-warning" value="Update" disabled />
          </form>
        </div>
      </div>
    </div>

    <!-- Computer Table -->
    <div id="padded-box" class="col-sm-6 border border-secondary rounded">
      <div id="table-overflow">
        <h6 id="txtRoomSel" style="color: green"></h6>
        <table class="table" id="main-table">
          <thead class="thead-dark">
            <tr>
              <th>Computer ID</th>
              <th>Name</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Room</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tblComputers">
            <% for (i = 0; i < computers.length; i++) { %>
            <tr>
              <td id="id"><%= computers[i]._id %></td>
              <td id="name"><%= computers[i].name %></td>
              <td id="status"><%= computers[i].status %></td>
              <td id="notes"><%= computers[i].notes %></td>
              <td id="room"><%= computers[i].room %></td>
              <td>
                <button class="getPC">Update</button>
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

    <div id="padded-box" class="col-sm-3 border border-secondary rounded">
      <a href="/dc">Remove Filter / Refresh to DC</a>

      <!-- Filter room form -->
      <div id="computer-form-box">
        <div id="formBox">
          <form method="post" action="/dcfilter">
            <div class="form-group">
              <label for="roomFilter">Room ID Filter</label>
              <input type="text" name="roomFilter" class="form-control" placeholder="Type here..." />
            </div>
            <div class="form-group">
              <input type="submit" class="form-control btn btn-primary" />
            </div>
          </form>
        </div>

        <!-- Remove computer form -->
        <form method="post" action="/remove">
          <div class="form-group">
            <label for="removeInput">Delete (by name)</label>
            <input type="text" name="removeInput" class="form-control" placeholder="Computer name..." />
          </div>
          <div class="form-group">
            <input type="submit" value="Remove" class="form-control btn btn-danger" />
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Error message -->
  <p id="errorMsg" style="color: rgb(216, 204, 204)"></p>

  <script>
    ///// JAVASCRIPT /////

    // Lock or Unlock update form
    function blockType(bool) {
      $("#txtId").attr("disabled", bool);
      $("#txtName1").attr("disabled", bool);
      $("#txtName2").attr("disabled", bool);
      $("#txtStatus").attr("disabled", bool);
      $("#txtNotes").attr("disabled", bool);
      $("#txtRoom").attr("disabled", bool);
      $("#btnUpdate").attr("disabled", bool);
    }

    function RandomNum() {
      var RandomNum = Math.random();
      var num = Math.round(RandomNum * 100);
      return num;
    }

    /////// JQUERY ///////

    $(document).ready(function () {
      // Get PC information (update form)
      $(".getPC").click(function () {
        let row = $(this).closest("tr");
        let id = row.find("#id").text();
        let pcName = row.find("#name").text();
        let pcStatus = row.find("#status").text();
        let pcNotes = row.find("#notes").text();
        let pcRoom = row.find("#room").text();

        blockType(false);

        $("#txtSearch").val(id);
        $("#txtName1").val(pcName);
        $("#txtName2").val(pcName);
        $("#txtStatus").val(pcStatus);
        $("#txtNotes").val(pcNotes);
        $("#txtRoom").val(pcRoom);
      });

      // Insert form validation
      $(".insertForm").submit(function (f) {
        let name = $("#inputName").val();
        let notes = $("#inputNotes").val();
        let room = $("#inputRoom").val();

        if (name == "") {
          f.preventDefault();
          $("#errorMsg").html("Please name your computer");
        } else if (notes == "") {
          $("#inputNotes").val("...");
        } else if (room == "") {
          $("#inputRoom").val("0");
        } else {
          $("#errorMsg").html(null);
          $("#errorMsg").attr("hidden", "true");
        }
      });

      // Update form validation
      $(".updateForm").submit(function (f) {
        let name1 = $("#txtName1").val();
        let name2 = $("#txtName2").val();
        let notes = $("#txtNotes").val();
        let room = $("txtRoom").val();

        if (name1 == "") {
          f.preventDefault();
          $("#errorMsg").html("Please do note remove text in the red box");
        } else if (name2 == "") {
          f.preventDefault();
          $("#errorMsg").html("Please enter a new value");
        } else if (notes == "") {
          $("#txtNotes").val("...");
        } else if (room == "") {
          $("#txtRoom").val("0");
        } else {
          $("#errorMsg").html(null);
          $("#errorMsg").attr("hidden", "true");
        }
      });
    });

    $(window).ready(function () {
      // Nothing...
    });
  </script>
</body>

</html>